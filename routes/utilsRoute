import express from "express";
import fetch from "node-fetch";

const router = express.Router();

router.get("/detect-country", async (req, res) => {
  try {
    const ip = req.ip;

    // Use HTTPS version (important)
    const response = await fetch(
      `https://ipapi.co/${ip}/json/`
    );

    const data = await response.json();

    res.json({
      success: true,
      countryCode: data.country_code || "IN",
    });

  } catch (error) {
    console.error("Country detection error:", error);

    res.json({
      success: false,
      countryCode: "IN",
    });
  }
});

export default router;
