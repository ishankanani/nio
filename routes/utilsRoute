import express from "express";
import fetch from "node-fetch";

const router = express.Router();

router.get("/detect-country", async (req, res) => {
  try {
    // âœ… With trust proxy enabled, this gives REAL client IP
    const ip = req.ip;

    console.log("Detected Client IP:", ip);

    const response = await fetch(
      `http://ip-api.com/json/${ip}`
    );

    const data = await response.json();

    res.json({
      success: true,
      countryCode: data.countryCode || "IN",
    });

  } catch (error) {
    console.error("Country detection error:", error);

    res.json({
      success: false,
      countryCode: "IN",
    });
  }
});

export default router;
